import 'dotenv/config';
import { createClient } from '@libsql/client';

interface StrategyData {
  character: string;
  strategies: string[];
}

async function seedCommonStrategies() {
  const url = process.env.TURSO_DATABASE_URL;
  const authToken = process.env.TURSO_AUTH_TOKEN;

  if (!url || !authToken) {
    console.error('TURSO_DATABASE_URL and TURSO_AUTH_TOKEN must be set');
    process.exit(1);
  }

  const db = createClient({ url, authToken });
  console.log('🔄 共通対策情報を一括登録\n');

  // 管理ユーザーID（仮）
  const ADMIN_USER_ID = 'system';

  const strategiesData: StrategyData[] = [
    {
      character: 'ソル=バッドガイ',
      strategies: [
        '【遠S対策】FDで距離を離してからの6P割り込みが有効。2Sでの6P潰しには後ろ下がりからリーチの長い技を当てる。',
        '【バンディットブリンガー】近距離立ちガードで投げが確定。反撃が届かない場合も2Kを推奨。',
        '【バンディットリヴォルバー】初段ガード後に6P。二段目を空かせつつ反撃でき、初段止めに対しても有利。'
      ]
    },
    {
      character: 'カイ=キスク',
      strategies: [
        '【フードゥルアルク】立ちガードで-2F。2Kや投げで反撃。※帯電時やしゃがみガード時はカイ側が有利。',
        '【スタンディッパー】ガードで-19F（帯電時-14F）。遠Sなどで確実に確定反撃を取る。',
        '【ゲージあり時】スタンディッパー赤RCに備え、垂直ジャンプやしゃがみガードを意識。'
      ]
    },
    {
      character: 'メイ',
      strategies: [
        '【S横イルカ】ガードでメイ側が-3F。ガード後は必ず2Kで反撃。6Pを置いておくのも有効。',
        '【HS横イルカ】ガードでメイ側が+7Fと大幅有利なため注意。',
        '【画面端のHS縦イルカ】前に一歩歩くだけで回避可能。空かして近Sや投げで反撃。'
      ]
    },
    {
      character: 'アクセル・ロウ',
      strategies: [
        '【近づき方】ダッシュガードか慣性前ジャンプ。前ジャンプは2HS等に確定を取りやすい。',
        '【5P対策】ダッシュで潜れる。読めたらガンダッシュ2Kで触りに行く。',
        '【2HS対策】慣性前ジャンプから降り際攻撃。スカった時の硬直が非常に大きいため確定が取れる。',
        '【冬蟷螂（コマ投げ）】後ろからのコマ投げ。バクステか前ジャンプで回避。画面端では前ジャンプが安全。',
        '【蝸牛】地上ガードで-24F。リーチの長い技で確定反撃。',
        '【百重鎌焼】初段ガード後に前ジャンプ入れっぱなしで確定反撃が取りやすい。'
      ]
    },
    {
      character: 'チップ・ザナフ',
      strategies: [
        '【冽掌】ガード後は遠Sなどの長い立ち技で暴れる。派生の麓砕（下段）を当てられてもチップ側が不利。',
        '【削岩脚】判定が弱いため5P等で落とす。ガード後は投げで暴れるのも有効。',
        '【幻朧斬（コマ投げ）】発生の遅いコマ投げ。見てからジャンプ攻撃やバクステで確定反撃、空投げも可。'
      ]
    },
    {
      character: 'ポチョムキン',
      strategies: [
        '【前メガフィスト】ガードで-6F。発生7F以下の技で確定反撃。小技で落とすことも可能。',
        '【スライドヘッド】モーションを見てから空中ダッシュ攻撃、またはバクステかしゃがみガードで対応。',
        '【ガルダインパクト】ガード後に読み合い。バクステ/上入れで投げに勝ち、立ちガード継続で打撃に五分。',
        '【ハンマフォール】ガードで-17F。確定反撃を取る。ゲージがある場合は無理せず後ろジャンプが安定。'
      ]
    },
    {
      character: 'ファウスト',
      strategies: [
        '【J2K（ドリル）】6Pを虚空に置きまくる。ガード後はダッシュガードで有利状況を作る。',
        '【遠S】6Pで勝てる。2HSを振ってくるまでは6Pを連打して良い。',
        '【2HS】全体硬直が長いため、ダッシュ慣性前ジャンプで確定反撃を狙う。',
        '【突きます】6Pで潰せる。溜め版（ガードでファウスト有利）に注意。',
        '【アイテム】ちびファウストはすぐ殴る。ラッパは全力で取りに行く。メテオは頑張ってガード。'
      ]
    },
    {
      character: 'ミリア=レイジ',
      strategies: [
        '【空中行動】空ダ2回や2段ジャンプ後の低ダが可能。低ダJHSの繰り返しが強いため、対空を意識。',
        '【投げ→HSタンデム】密着起き攻めは一歩後ろに歩いてから後ろジャンプすると全対応しやすい。'
      ]
    },
    {
      character: 'ザトー=ONE',
      strategies: [
        '【「突く」】1段目と2段目の間は5F技で割り込める。',
        '【「多い！」】ガード後の崩しに対し、黄色RCやディフレクトシールドが有効。',
        '【「跳ねる」】読めたら6Pで潰せる。',
        '【「張り合う」】走って投げる。攻撃→赤RCで本体に衝撃波を当てるのも有効。',
        '【分身飛ばし】ドランカーで飛ばしてきたら、移動先に先回りして2Pなどで潰す。'
      ]
    },
    {
      character: 'ラムレザル=ヴァレンタイン',
      strategies: [
        '【遠S、5HS】リーチは長いが硬直も長い。慣性前Jで飛び越えて攻撃、または6Pで対処。',
        '【端バヨネット】剣の爆発直前の択を整理。シルドには立ちガード、2Kには投げ連打で対応。',
        '【オンド】ガードでラム側が-4F。低ダで突っ込むのも有効。'
      ]
    },
    {
      character: 'レオ・ホワイトファング',
      strategies: [
        '【特殊技4（GP）】下段は取れない。構えが見えたらリーチの長い下段技を狙う。',
        '【ツヴァイト（めくり）】発生が早めだが投げで割り込める。',
        '【エアースト（突進）】ガードで-6F。2K等で確定が取れるキャラは練習しておく。',
        '【背向け時】攻めに付き合わず、無敵技をパなす、ガンFDで離れてから逃げる、小技連打で割り切る。'
      ]
    },
    {
      character: 'ナゴリユキ',
      strategies: [
        '【基本方針】ブラッドゲージが溜まるまで逃げ回り、必殺技が撃てなくなってから攻め込む。',
        '【冠雪】ガードするだけでゲージを消費させられる。ガード後は立ちガード安定。',
        '【垂雪】2段目が中段だが立ちガードで安定。その後の不香（移動）を小技で暴れて止める。',
        '【粒雪】不香とセットで来ることが多いため、読めたら前ジャンプ攻撃を叩き込む。'
      ]
    },
    {
      character: 'ジオヴァーナ',
      strategies: [
        '【足払い】読めたら前ジャンプからジャンプ攻撃を被せる。',
        '【セパルトゥラ】ガードでジオ側が-5F。リーチの長い技か2Kで反撃。遅らせ版には6P。',
        '【トロヴァォン】見えたら6Pで落とせる。ガード時はジオ側が大幅有利。',
        '【ソウ・ポエンチ】ガードでジオ側が-5F。4入れP+K入力（FDと6PのOS）が有効。'
      ]
    },
    {
      character: '御津闇慈',
      strategies: [
        '【基本方針】「ガンダッシュ投げ」を多用する。当身（水月）や風神に噛み合って通りやすい。',
        '【水月のハコビ】走って投げる。技を当ててしまったら遅らせ紫RCで後出しジャンケンをする。',
        '【風神ガード後】派生なしは2K確定、針は前J攻撃確定、一足飛びは投げ、凪刃は2K確定、臨は近S確定。',
        '【溜め風神】読めたら小技で暴れる。'
      ]
    },
    {
      character: 'イノ',
      strategies: [
        '【基本方針】全て凌ぐのは困難なため割り切る。近い距離は6P連打、防御時は必ずFDを貼る。',
        '【大木をさする手】S版はガード後7F以内の技で反撃。HS版は-2Fだが2Kや投げが有効。',
        '【狂愛アジタート】モーションが見えたら5Pや6Pで落とす。',
        '【限界フォルテッシモ】地上版ガード後、衝撃波が来る前に確定反撃。わからなければ空投げ。'
      ]
    },
    {
      character: 'ゴールドルイス',
      strategies: [
        '【防御】サンダーバード以外は全てフォルトレスディフェンス（FD）を推奨。',
        '【ベヒモスタイフーン】発生の早いものは-5F。ガード後は後ろ要素を入れつつ長い技を押す。',
        '【サンダーバード】ハイジャンプ、2段ジャンプ、バクステで逃げる。本体を殴って消すのもあり。'
      ]
    },
    {
      character: 'ジャック・オー',
      strategies: [
        '【サーヴァント】自分の近くに置かせない。5P/6P/5K等で弾かれた鯖も壊す。壊せなければ空ガからバクステ。',
        '【防御指示】読んだら走り込んで投げ、または本体を攻撃。'
      ]
    },
    {
      character: 'ハッピーカオス',
      strategies: [
        '【射撃連携】しっかり狙う→リロード等の合間にダッシュガードで近づかない（撃たれる）。集中のモーションで走る。',
        '【カース】最も警戒。付与されたら効果が切れるまで動かない。立ち回りカースを上いれっぱで避ける。'
      ]
    },
    {
      character: '梅喧',
      strategies: [
        '【柊（リバサ当て身）】読めたら投げるのが最安定。後半部分に攻撃を当てるのも有効。',
        '【Sカバリ（紐）後】5P連打にはFDから6P、2K/近Sには投げ、投げには小技暴れで対応。'
      ]
    },
    {
      character: 'テスタメント',
      strategies: [
        '【ステイン状態】アンホーリーダイバー等を食らったら付与。リターンが爆増するため切れるまで逃げ回る。',
        '【遠S】リーチは長いが6Pで避けながら反撃可能。虚空に6Pを置く。',
        '【グレイブリーパー】S版は前ジャンプ攻撃で確定。HS版は無視。サキュバスの位置に注意。',
        '【アンホーリーダイバー】モーションが見えたら2段ジャンプでカラスを避ける。',
        '【ポゼッション】サキュバスが近くにいる時のみ、見えたら小技で暴れる。'
      ]
    },
    {
      character: 'ブリジット',
      strategies: [
        '【ローリング】6Pで落とせるが難しいため、2段ジャンプやハイジャンプで逃げるのがおすすめ。',
        '【ローリングからの中下】読みで立ちFD（JDガード後に6P割り込み）か、屈FD（2Kガード後にバクステ逃げ）。',
        '【遠S、5HS】6Pで避けながら攻撃可能。虚空に6Pを置いておく。'
      ]
    },
    {
      character: 'シン=キスク',
      strategies: [
        '【スタミナゲージ】ゲージ消費派生をガードしたら手を出さない。派生なしならシン側大幅不利で確定もあり。',
        '【フーフスタンプ】ガード後は無敵技が確定。無敵技がないなら投げ連打で派生を割る。',
        '【エルクハント】攻撃発生前を投げで割り込める（一点読み推奨）。',
        '【効率的防御】足払い/HSガード後は「立ちガード」安定。エルクハントの投げのみに集中できる。'
      ]
    },
    {
      character: 'ベッドマン?',
      strategies: [
        '【Call 4BA】慣性前ジャンプで針を飛び越しつつ触りに行く。',
        '【2HSガード後】4B9（爆発）には2K連打、4B3（暴れ潰し）はガードして確定反撃。'
      ]
    },
    {
      character: 'アスカ',
      strategies: [
        '【2D】読めたら前ジャンプで確定反撃。弾属性のため硬直中も被カウンター判定。',
        '【マナゲージ】ダメージを与えてマナを減らす。マナ切れ時は防御力が大幅に下がるためフルコンのチャンス。',
        '【魔法対策】キューブ魔法は6Pで壊す。アキピテルメトロン（中段）とアルペジオ（連弾）を特に警戒。'
      ]
    },
    {
      character: 'ジョニー',
      strategies: [
        '【遠S】虚空に6Pを置くか、慣性前ジャンプ攻撃で反撃。',
        '【6K→燕穿牙】6Kガード後に6Pで割り込める。',
        '【ミストファイナー】ガードで-15F。リーチの長い技で確定反撃。ダッシュガードで距離を詰める。',
        '【跳躍→ディール】ガード後はジョニー側が微不利なため2K等で反撃。跳躍自体に5P割り込みも可能。'
      ]
    },
    {
      character: 'スレイヤー',
      strategies: [
        '【Kマッパハンチ】めり込みガードなら投げが確定。ダッシュガードで距離を詰めてガードする。',
        '【ダンディーステップ】モーションが見えたら後ろジャンプが安定。マスターズハンマーに確定を取れることもある。'
      ]
    },
    {
      character: 'ディズィー',
      strategies: [
        '【魚（S/HS）】ガード後はダッシュガードで接近。氷原まで出されても接近のチャンス。',
        '【氷原】ダッシュガードを連打して近づく。空ガすると端まで戻されるため注意。',
        '【話し相手】小技やリーチの長い技で壊せる。'
      ]
    },
    {
      character: 'ルーシー',
      strategies: [
        '【スプリントアタック】6F以下の技で確定反撃。下段派生は12F以下、めくり派生はガード後S系統の技で反撃。',
        '【モノワイヤー】上に判定が狭いため、前ジャンプ攻撃で確定反撃。',
        '【ブレイクアウト（無敵技）】ガード後はダッシュで距離を詰めて被カウンター状態の相手を叩く。'
      ]
    }
  ];

  try {
    let successCount = 0;
    let errorCount = 0;

    for (const data of strategiesData) {
      console.log(`\n📝 ${data.character}:`);

      // キャラクターIDを取得
      const charResult = await db.execute({
        sql: 'SELECT id FROM characters WHERE name = ?',
        args: [data.character]
      });

      if (charResult.rows.length === 0) {
        console.log(`  ⚠️  キャラクターが見つかりません: ${data.character}`);
        errorCount++;
        continue;
      }

      const characterId = charResult.rows[0].id;

      // 各対策情報を登録
      for (const strategy of data.strategies) {
        try {
          await db.execute({
            sql: `
              INSERT INTO common_strategies (target_character, target_character_id, strategy_content, created_by_discord_id)
              VALUES (?, ?, ?, ?)
            `,
            args: [data.character, characterId, strategy, ADMIN_USER_ID]
          });
          console.log(`  ✅ 登録成功`);
          successCount++;
        } catch (error: any) {
          console.log(`  ❌ 登録失敗: ${error.message}`);
          errorCount++;
        }
      }
    }

    console.log(`\n\n📊 登録結果:`);
    console.log(`  成功: ${successCount}件`);
    console.log(`  失敗: ${errorCount}件`);
    console.log(`\n✅ 一括登録完了`);

  } catch (error) {
    console.error('❌ Error:', error);
    process.exit(1);
  } finally {
    db.close();
  }
}

seedCommonStrategies();
